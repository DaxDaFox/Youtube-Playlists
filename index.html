<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YouTube Playlists</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #status { margin-bottom: 10px; }
  #playlists { margin-top: 20px; }
  .playlist-btn { display: block; margin: 5px 0; }
</style>
</head>
<body>

<h1>YouTube Playlists</h1>
<div id="status">Not signed in.</div>
<button id="signinBtn">Sign in with Google</button>
<div id="playlists"></div>

<!-- Load the Google API client library -->
<script src="https://apis.google.com/js/api.js"></script>
<script>
  const CLIENT_ID = '656269912892-ah9lfkjdh8e6q40hrmh4ogurc336gqqr.apps.googleusercontent.com'; // <-- Replace here
  let authInstance = null;
  let accessToken = '';

  // Load the API and initialize auth2
  function start() {
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    gapi.client.init({
      clientId: CLIENT_ID,
      scope: 'https://www.googleapis.com/auth/youtube.force-ssl'
    }).then(() => {
      authInstance = gapi.auth2.getAuthInstance();
      // Attach click event after init
      document.getElementById('signinBtn').onclick = signIn;
    });
  }

  function signIn() {
    authInstance.signIn().then(user => {
      const authResponse = user.getAuthResponse();
      accessToken = authResponse.access_token;
      document.getElementById('status').innerText = 'Signed in!';
      fetchPlaylists();
    }).catch(error => {
      console.error('Error signing in:', error);
      alert('Sign-in failed. Please try again.');
    });
  }

  async function fetchPlaylists() {
    if (!accessToken) {
      alert('Not authenticated');
      return;
    }
    try {
      const response = await fetch(
        'https://www.googleapis.com/youtube/v3/playlists?part=snippet&mine=true',
        {
          headers: { Authorization: 'Bearer ' + accessToken }
        }
      );
      const data = await response.json();
      if (data.error) {
        alert('Error: ' + data.error.message);
        return;
      }
      displayPlaylists(data.items);
    } catch (err) {
      alert('Fetch error: ' + err);
    }
  }

  function displayPlaylists(playlists) {
    const container = document.getElementById('playlists');
    container.innerHTML = '';
    if (!playlists || playlists.length === 0) {
      container.innerText = 'No playlists found.';
      return;
    }
    playlists.forEach(pl => {
      const btn = document.createElement('button');
      btn.className = 'playlist-btn';
      btn.innerText = pl.snippet.title;
      btn.onclick = () => {
        alert('Clicked playlist: ' + pl.snippet.title);
      };
      container.appendChild(btn);
    });
  }

  // Initialize everything
  start();
</script>
</body>
</html>
