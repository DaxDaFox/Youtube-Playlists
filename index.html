<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YouTube Playlist Manager</title>
<!-- Load Google's platform library -->
<script src="https://apis.google.com/js/platform.js" async defer></script>
<style>
  body { font-family: Arial, sans-serif; background:#222; color:#eee; padding:20px; }
  button { padding:10px; margin:10px 0; font-size:16px; }
  #playlists { margin-top:20px; }
  .playlist-btn { display:block; margin:5px 0; padding:10px; background:#3ea6ff; border:none; cursor:pointer; font-size:16px; }
</style>
</head>
<body>

<h1>YouTube Playlist Manager</h1>
<button id="signinBtn">Sign in with Google</button>
<div id="status"></div>
<div id="playlists"></div>

<script>
  let auth2;
  let accessToken = '';
  let currentVideoId = '';

  // Initialize Google Sign-In
  function initGapi() {
    gapi.load('auth2', () => {
      auth2 = gapi.auth2.init({
        client_id: '656269912892-ah9lfkjdh8e6q40hrmh4ogurc336gqqr.apps.googleusercontent.com', // <-- Replace with your OAuth client ID
        scope: 'https://www.googleapis.com/auth/youtube.force-ssl'
      });
    });
  }

  document.getElementById('signinBtn').onclick = () => {
    auth2.signIn().then(user => {
      // Get access token
      const authResponse = user.getAuthResponse();
      accessToken = authResponse.access_token;
      document.getElementById('status').innerText = 'Signed in!';
      fetchPlaylists();
    });
  };

  // Extract current video ID from URL
  function getVideoId() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('v');
  }

  // Fetch playlists
  async function fetchPlaylists() {
    if (!accessToken) return;
    const response = await fetch('https://www.googleapis.com/youtube/v3/playlists?part=snippet&mine=true', {
      headers: {
        Authorization: 'Bearer ' + accessToken
      }
    });
    const data = await response.json();
    if (data.error) {
      alert('Error fetching playlists: ' + data.error.message);
      return;
    }
    displayPlaylists(data.items);
  }

  // Display playlists
  function displayPlaylists(playlists) {
    const container = document.getElementById('playlists');
    container.innerHTML = '';
    playlists.forEach(pl => {
      const btn = document.createElement('button');
      btn.className = 'playlist-btn';
      btn.innerText = pl.snippet.title;
      btn.onclick = () => {
        addVideoToPlaylist(pl.id);
      };
      container.appendChild(btn);
    });
  }

  // Add current video to playlist
  async function addVideoToPlaylist(playlistId) {
    if (!accessToken) {
      alert('Please sign in first.');
      return;
    }
    const videoId = getVideoId();
    if (!videoId) {
      alert('Cannot detect video ID from URL.');
      return;
    }

    const response = await fetch('https://www.googleapis.com/youtube/v3/playlistItems?part=snippet', {
      method: 'POST',
      headers: {
        Authorization: 'Bearer ' + accessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        snippet: {
          playlistId: playlistId,
          resourceId: {
            kind: 'youtube#video',
            videoId: videoId
          }
        }
      })
    });
    const result = await response.json();
    if (result.error) {
      alert('Error adding video: ' + result.error.message);
    } else {
      alert('Video added to playlist!');
    }
  }

  // Initialize on page load
  window.onload = () => {
    initGapi();
    // If URL has video ID, show it
    currentVideoId = getVideoId();
    if (currentVideoId) {
      document.getElementById('status').innerText = 'Current Video ID: ' + currentVideoId;
    }
  };
</script>
</body>
</html>
